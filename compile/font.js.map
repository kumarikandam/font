{
"version":3,
"file":"compile/font.js",
"lineCount":4,
"mappings":"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",
"sources":[" [synthetic:es6/util/arrayiterator] "," [synthetic:es6/util/makeiterator] ","src/font.js","src/index.js"],
"sourcesContent":["/*\n * Copyright 2016 The Closure Compiler Authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Utility method for creating an iterator for Arrays.\n */\n'require base';\n\n/**\n * Returns an internal iterator from the given array.\n * @param {!Array<T>} array\n * @return {function():!IIterableResult<T>}\n * @template T\n */\n$jscomp.arrayIteratorImpl = function(array) {\n  var index = 0;\n  return function() {\n    if (index < array.length) {\n      return {\n        done: false,\n        value: array[index++],\n      };\n    } else {\n      return {done: true};\n    }\n  };\n};\n\n/**\n * Returns an internal iterator from the given array.\n * @param {!Array<T>} array\n * @return {!Iterator<T>}\n * @template T\n */\n$jscomp.arrayIterator = function(array) {\n  return /** @type {!Iterator<T>} */ ({next: $jscomp.arrayIteratorImpl(array)});\n};\n\n","/*\n * Copyright 2016 The Closure Compiler Authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Polyfill for for-of loops.\n */\n'require es6/util/arrayiterator';\n\n/**\n * Creates an iterator for the given iterable.  This iterator should never\n * be exposed to user code.\n *\n * @param {string|!Iterable<T>|!Iterator<T>|!Arguments} iterable\n * @return {!Iterator<T>}\n * @template T\n * @suppress {reportUnknownTypes}\n */\n$jscomp.makeIterator = function(iterable) {\n  // NOTE: Disabling typechecking because [] not allowed on @struct.\n  var iteratorFunction = typeof Symbol != 'undefined' && Symbol.iterator &&\n      (/** @type {?} */ (iterable)[Symbol.iterator]);\n  return iteratorFunction ? iteratorFunction.call(iterable) :\n      $jscomp.arrayIterator(/** @type {!Array} */ (iterable));\n};\n","import font from './'\n\nwindow['@lemuria/font'] = font","/* eslint-env browser */\nconst GOOGLE_URL = 'https://fonts.googleapis.com/css?display=swap&family='\n\n/**\n * Loads A Web Font Stylesheet (e.g., Google Fonts) Without Render Blocking And Multiple Layout Updates.\n * @param {string} url The full url of the web-font to load, e.g., `https://fonts.googleapis.com/css?display=swap&family=Limelight`.\n * @param {Object=} [defaultRanges] When the stylesheet was loaded before body was parsed, there's no way for the script to know which fonts to load based on `unicode-range` property of the `@font-face`. By passing an object with ranges, only specific fonts will be preloaded. Must be an object in the following format (taken directly from the stylesheet):\n```js\n{\n  'U+0000-00FF, U+0131, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD': true\n}\n```\n */\nexport default function font(url, defaultRanges = {}) {\n  /**\n   * @param {string} address The address to load.\n   * @param {function(string)} cb The callback to call on complete.\n   * @param {string} [marker] Performance annotation.\n   */\n  const fetchStylesheet = (address, cb, marker = '') => {\n    performance.mark('xhr-start'+marker)\n    const xhr = new XMLHttpRequest()\n    xhr.onreadystatechange = () => {\n      if(xhr.readyState == 4) {\n        if (xhr.status == 200) {\n          cb(xhr.responseText)\n          performance.mark('xhr-end'+marker)\n          performance.measure('xhr'+marker, 'xhr-start'+marker, 'xhr-end'+marker)\n        } else {\n          console.error('Error loading webfont: server responded with code %s at %s', xhr.status, address)\n        }\n      }\n    }\n    xhr.open('GET', address)\n    try {\n      xhr.send(null)\n    } catch (err) {\n      console.error(err)\n    }\n  }\n\n  const FONT = url\n\n  performance.mark('agf-start')\n\n  let FONT_CSS\n  startPreload({ href: FONT }, 'js')\n\n  function parseBody(result) {\n    const re = /url\\((.+?)\\).*?;\\s+unicode-range: (.+?);/g\n    let ranges = {}\n    const fonts = []\n    let a\n    while((a = re.exec(result))) {\n      const [, u, range] = a\n      fonts.push({ url: u, range })\n      ranges[range] = 1\n    }\n    ranges = Object.keys(ranges).reduce((acc, range) => {\n      const reg = range\n        .split(/,\\s/)\n        .map((r) => r.replace('U+', '\\\\u').replace('-', '-\\\\u'))\n        .join('').toLowerCase()\n      acc[range] = new RegExp(`[${reg}]`)\n      return acc\n    }, {})\n\n    const body = document.body ? document.body.innerText : ''\n    const validRanges = body ? Object.keys(ranges).reduce((acc, range) => {\n      const reg = ranges[range]\n      const valid = reg.test(body)\n      if (valid) acc[range] = true\n      return acc\n    }, {}) : Object.keys(ranges).reduce((acc, range) => {\n      const valid = range in defaultRanges\n      if (valid) acc[range] = true\n      return acc\n    }, {})\n\n    urls = fonts.filter(({ range }) => {\n      return range in validRanges\n    }).map(({ url: u }) => u)\n    if (!urls.length) return loadedCb()\n\n    const fragment = document.createDocumentFragment()\n    urls.forEach((address, i) => {\n      const link = document.createElement('link')\n      link.href = address\n      link.rel = 'preload'\n      link.as = 'font'\n      performance.mark('link-preload-start'+i)\n      link.onload = () => loadedCb(i)\n      link.setAttribute('crossorigin', true)\n      fragment.appendChild(link)\n    })\n    document.head.appendChild(fragment)\n  }\n\n  function startPreload(linkEl, marker = 'link') {\n    const href = linkEl.href\n    fetchStylesheet(href, (res) => {\n      FONT_CSS = res\n      parseBody(FONT_CSS)\n    }, '-' + marker)\n  }\n  let urls = []\n  let loaded = 0\n  /**\n   * @param {number} [i] The index of the link\n   */\n  const loadedCb = (i) => {\n    if (i) {\n      performance.mark('link-preload-end'+i)\n      performance.measure('link-preload', 'link-preload-start'+i, 'link-preload-end'+i)\n    }\n    loaded++\n    if (loaded >= urls.length) {\n      const style = document.createElement('style')\n      style.innerHTML = FONT_CSS\n      document.head.appendChild(style)\n\n      performance.mark('agf-end')\n      performance.measure('@lemuria/font', 'agf-start', 'agf-end')\n    }\n  }\n}\n\nexport const debug = font\n\n// latin: 'U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD'"],
"names":["$jscomp.arrayIteratorImpl","window","font","url","defaultRanges","loadedCb","i","performance","mark","measure","loaded","urls","length","style","document","createElement","innerHTML","FONT_CSS","head","appendChild","fetchStylesheet","address","cb","marker","xhr","XMLHttpRequest","onreadystatechange","xhr.onreadystatechange","readyState","status","responseText","console","error","open","send","err","parseBody","result","re","ranges","fonts","a","exec","$jscomp.makeIterator","u","range","push","Object","keys","reduce","acc","reg","split","map","r","replace","join","toLowerCase","RegExp","body","innerText","validRanges","test","valid","filter","fragment","createDocumentFragment","forEach","link","href","rel","as","onload","link.onload","setAttribute","startPreload","linkEl","res"]
}
